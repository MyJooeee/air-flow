(this["webpackJsonpair-flow"]=this["webpackJsonpair-flow"]||[]).push([[0],{105:function(e,t,a){},106:function(e,t,a){},116:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a.n(i),o=a(20),r=a.n(o),l=(a(105),a(106),a(51)),s=a.n(l),c=a(170),u=a(172),d=a(171),h=a(174),m=a(176),p=a(173),g=a(2);var j=e=>{let{loading:t,name:a}=e;if(t)return Object(g.jsx)(p.a,{width:150,height:80});return Object(g.jsxs)(m.a,{variant:"h4",children:[" ","Air quality in"," ",a," "]})};var b=e=>{let{loading:t,airQuality:a,indexQuality:i}=e;if(t)return Object(g.jsx)(p.a,{width:150,height:40});if(0===i)return null;let n=" ("+(6-i)/5*100+"%)";return Object(g.jsxs)(m.a,{variant:"h5",children:[" ","Quality :"," ",a[i-1]," ",n," "]})};var O=e=>{let{loading:t,weather:a}=e;if(t)return Object(g.jsx)(p.a,{width:180,height:40});const i="https://openweathermap.org/img/wn/"+a.icon+".png",n=a.main,o=a.description,r=a.icon,l=a.temperature,s=a.humidity;return Object(g.jsxs)(h.a,{sx:{flexFlow:"row wrap",alignItems:"center",gap:1},children:[Object(g.jsx)("img",{src:i,title:n,alt:r}),Object(g.jsxs)(m.a,{children:[l,"\xb0C. | ",s,"%"]}),Object(g.jsx)(m.a,{children:o})]})},x=a(5),f=a.n(x),y=(a(113),a(163)),w=a(177),v=a(164),S=a(165),A=a(166),F=a(83),I=a(25);var z=e=>{let{geoloc:t}=e;if(!t.longitude&&!t.latitude)return null;const a=[t.latitude,t.longitude];return Object(g.jsxs)(y.a,{id:"mapId",center:a,zoom:14,scrollWheelZoom:!1,style:{height:180,width:180,margin:"20px"},children:[Object(g.jsx)(C,{center:a,zoom:14}),Object(g.jsx)(w.a,{attribution:"\xa9AirFlow",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Object(g.jsx)(v.a,{position:a,icon:new I.Icon({iconUrl:F.a,iconSize:[25,41],iconAnchor:[12,41]}),children:t.altitude&&Object(g.jsx)(q,{altitude:t.altitude})})]})};const C=e=>{let{center:t,zoom:a}=e;return Object(S.a)().setView(t,a),null};C.propTypes={center:f.a.array,zoom:f.a.number};const q=e=>{let{altitude:t}=e;return Object(g.jsx)(A.a,{children:"alt. ".concat(t.toFixed(2),"m")})},P=(e,t)=>fetch(e).then((e=>e.json())).then((e=>e),(e=>{console.log(e),t(e)})),D={flexFlow:"row wrap",alignItems:"center",justifyContent:"space-around"};var H=()=>{const e="43cebb6f101584f15a47a1581d009ee7",t="https://api.openweathermap.org/data/2.5/air_pollution?appid="+e,a="https://api.openweathermap.org/geo/1.0/reverse?limit=1&appid="+e,n="https://api.openweathermap.org/data/2.5/weather?&units=metric&appid="+e,[o,r]=Object(i.useState)(new Date),[l,p]=Object(i.useState)({open:!1,message:null,severity:"error",vertical:"top",horizontal:"right"}),{open:x,message:f,severity:y,vertical:w,horizontal:v}=l,[S,A]=Object(i.useState)({times:[],co:[],o3:[],so2:[],pm25:[]}),[F,I]=Object(i.useState)({latitude:null,longitude:null,altitude:null}),[C,q]=Object(i.useState)(null),[H,Q]=Object(i.useState)({main:null,description:null,icon:null,temperature:null,humidity:null}),[E,T]=Object(i.useState)(!0),[k,W]=Object(i.useState)(0),[B,J]=Object(i.useState)(!0),[L,M]=Object(i.useState)(!0),[N,_]=Object(i.useState)(!1);Object(i.useEffect)((()=>{if(navigator.geolocation){const e={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};navigator.geolocation.getCurrentPosition((e=>{I({latitude:e.coords.latitude,longitude:e.coords.longitude,altitude:e.coords.altitude})}),(e=>{console.log(e),I({latitude:48.856614,longitude:2.3522219,altitude:35}),q("Paris"),T(!1)}),e)}}),[]),Object(i.useEffect)((()=>{if(F.latitude&&F.longitude){if(E&&Z(),U())return;V(),G(),localStorage.setItem("lastFetch",new Date),_(!0)}}),[F.latitude,F.longitude,F.altitude]),Object(i.useEffect)((()=>{if(N){const e=setInterval((()=>{V(),G(),localStorage.setItem("lastFetch",new Date)}),3e5);return()=>clearInterval(e)}}),[N]);const R=()=>{p({...l,open:!1})},U=()=>{const e=localStorage.getItem("lastFetch");if(e){if(s()().diff(s()(e),"seconds")<=10)return p({...l,severity:"warning",message:"Retry to fetch API later please",open:!0}),!0}return!1},V=async()=>{try{const e=t+"&lat="+F.latitude+"&lon="+F.longitude,a=await P(e,(e=>{p({...l,message:"Air quality data API error",open:!0})}));let i={...S};const n=i.co,o=i.o3,s=i.so2,c=i.pm25,u=n.length,d=o.length,h=s.length,m=c.length,g=a.list[0].components.co,j=a.list[0].components.o3,b=a.list[0].components.so2,O=a.list[0].components.pm2_5;if(r(new Date),u&&n[u-1]===g&&d&&o[d-1]===j&&h&&s[h-1]===b&&m&&c[m-1]===O)return;n.push(g),o.push(j),s.push(b),c.push(O);const x=i.times;x.push(new Date),i={times:x,co:n,o3:o,so2:s,pm25:c},A(i),W(a.list[0].main.aqi),J(!1)}catch(e){p({...l,message:"Air quality data processing error",open:!0})}},Z=async()=>{try{const e=a+"&lat="+F.latitude+"&lon="+F.longitude,t=await P(e,(e=>{p({...l,message:"Name location data API error",open:!0})}));q(t[0].name),T(!1)}catch(e){p({...l,message:"Name location data processing error",open:!0})}},G=async()=>{try{const e=n+"&lat="+F.latitude+"&lon="+F.longitude,t=await P(e,(e=>{p({...l,message:"Weather location data API error",open:!0})})),a=t.weather[0].main,i=t.weather[0].description,o=t.weather[0].icon,r=t.main.temp,s=t.main.humidity;if(H.main===a&&H.description===i&&H.icon===o&&H.temperature===r&&H.humidity===s)return;Q({main:a,description:i,icon:o,temperature:r,humidity:s}),M(!1)}catch(e){p({...l,message:"Weather location data processing error",open:!0})}};return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(u.a,{anchorOrigin:{vertical:w,horizontal:v},autoHideDuration:5e3,open:x,onClose:R,children:Object(g.jsx)(d.a,{onClose:R,severity:y,variant:"filled",sx:{width:"100%"},children:f})}),Object(g.jsxs)(h.a,{children:[Object(g.jsxs)(h.a,{sx:D,children:[Object(g.jsx)(j,{loading:E,name:C}),Object(g.jsx)(b,{loading:B,airQuality:["good quality","fair quality","moderate quality","poor quality","very poor quality"],indexQuality:k}),Object(g.jsx)(O,{loading:L,weather:H}),Object(g.jsx)(z,{geoloc:F})]}),Object(g.jsx)(c.a,{xAxis:[{label:"Hours",data:S.times,scaleType:"time",valueFormatter:e=>s()(e).format("HH:mm:ss")}],yAxis:[{label:"Concentration of particles, \u03bcg/m3"}],series:[{label:"CO (Carbon monoxide)",data:S.co},{label:"O3 (Ozone)",data:S.o3},{label:"SO2 (Sulphur dioxide)",data:S.so2},{label:"PM2.5 (Fine particles matter)",data:S.pm25}],height:400,margin:{left:60,right:30,top:30,bottom:60},grid:{vertical:!0,horizontal:!0}}),Object(g.jsxs)(m.a,{sx:{textAlign:"center"},children:["Air Flow detects changes in air quality ",Object(g.jsx)("strong",{children:" every 5 minutes "}),"(last check: ",Object(g.jsxs)("strong",{children:[" ",s()(o).format("HH:mm:ss"),") "]}),"."]})]})]})};var Q=function(){return Object(g.jsx)(H,{})};var E=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,178)).then((t=>{let{getCLS:a,getFID:i,getFCP:n,getLCP:o,getTTFB:r}=t;a(e),i(e),n(e),o(e),r(e)}))};r.a.render(Object(g.jsx)(n.a.StrictMode,{children:Object(g.jsx)(Q,{})}),document.getElementById("root")),E()}},[[116,1,2]]]);
//# sourceMappingURL=main.ad6c0006.chunk.js.map